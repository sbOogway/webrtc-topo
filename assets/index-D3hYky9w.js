(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const u="https://kv.valkeyrie.com/turtles/",p={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},h=document.getElementById("callButton"),y=document.getElementById("callInput"),w=document.getElementById("answerInput"),v=document.getElementById("answerButton"),B=document.getElementById("acceptAnswerButton"),I=document.getElementById("messageInput"),O=document.getElementById("messageButton"),g=document.getElementById("messageDiv"),T=document.getElementById("offerDiv"),b=(t,e)=>{fetch(u+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({k:e})}).then(o=>{if(!o.ok)throw new Error("Network response was not ok "+o.statusText);return console.log(o),o})},E=t=>{fetch(u+t).then(e=>{if(!e.ok)throw console.log(e),new Error("Network response was not ok "+e.statusText);return console.log(e),e.text})};function d(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=o.length,n=0;n<t;n++)e+=o.charAt(Math.floor(Math.random()*s));return e}const f=()=>{const t=new RTCPeerConnection(p);return t.onicecandidate=e=>{console.log("new ice candidate. i print my sdp"),console.log(JSON.stringify(t.localDescription)),T.innerHTML=`<p>${JSON.stringify(t.localDescription)}</p><br>`},t},k=t=>{t.createOffer().then(e=>t.setLocalDescription(e))},C=(t,e)=>{t.ondatachannel=o=>{const s=o.channel;s.onmessage=n=>{console.log("messsage received!!!"+n.data),g.innerHTML+=`<p>${n.data}</p><br>`},s.onopen=n=>{console.log("open!!!!"),s.send("yo g wassup")},s.onclose=n=>console.log("closed!!!!!!"),t.channel=s},t.setRemoteDescription(e).then(o=>console.log("offer accepted"))},D=async t=>{await t.createAnswer().then(e=>t.setLocalDescription(e)).then(e=>console.log(JSON.stringify(t.localDescription)))},L=(t,e)=>{t.setRemoteDescription(e).then(o=>console.log("answer accepted"))},m=d(10);b(m,"allgoodg");setTimeout(()=>{E(m)},2e3);const l=new Map;var r,a;h.onclick=async()=>{console.log("dbg offer");const t=f();r=t.createDataChannel("data"),r.onmessage=e=>{console.log("message received "+e.data),g.innerHTML+=`<p>${e.data}</p><br>`},r.onopen=e=>console.log("data channel opened"),r.onclose=e=>console.log("data channel closed"),t.channel=r,k(t),a=d(8),l.set(a,t)};v.onclick=async()=>{const t=JSON.parse(y.value),e=f();C(e,t),D(e),a=d(8),l.set(a,e)};B.onclick=async()=>{const t=JSON.parse(w.value);L(l.get(a),t)};O.onclick=async()=>{const t=I.value;l.forEach((e,o)=>{console.log(e),e.channel.send(t)})};
